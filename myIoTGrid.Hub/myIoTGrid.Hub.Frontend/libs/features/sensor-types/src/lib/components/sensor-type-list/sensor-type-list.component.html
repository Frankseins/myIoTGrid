<div class="sensor-type-list-page">
  @if (!initialLoadDone) {
    <myiotgrid-loading-spinner message="Sensortypen werden geladen..."></myiotgrid-loading-spinner>
  } @else if (totalRecords === 0) {
    <myiotgrid-empty-state
      icon="category"
      title="Keine Sensortypen"
      message="Es wurden noch keine Sensortypen angelegt."
      actionLabel="Neuer Sensortyp"
      (actionClicked)="onCreate()">
    </myiotgrid-empty-state>
  } @else {
    <header class="page-header">
      <div class="header-content">
        <h1 class="page-title">Sensortypen</h1>
        <p class="page-subtitle">Sensor-Definitionen mit Protokollen und Messf√§higkeiten verwalten</p>
      </div>
    </header>
    <myiotgrid-generic-table
        [data]="sensorTypes"
        [totalRecords]="totalRecords"
        [loading]="loading"
        [columns]="columns"
        dataKey="id"
        [stateKey]="'sensor-types-table'"
        [globalFilterFields]="['id','code','name','manufacturer']"
        createLabel="Neuer Sensortyp"
        [useGlobalSearch]="false"
        detailTitle="Sensortyp"
        (lazyLoad)="loadSensorTypesLazy($event)"
        (edit)="onEdit($any($event))"
        (remove)="deleteSensorType($any($event))"
        (create)="onCreate()"
        [detailMode]="'route'"
        detailRouteBase="/sensor-types"
        [showFilter]="true"
        filterTitle="Sensortypen filtern"
        (filterChange)="onFilterChange($event)">

        <!-- Filter Template -->
        <ng-template #filterTemplate let-filters>
            <div class="filter-fields">
                <!-- Hersteller -->
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Hersteller</mat-label>
                    <input matInput
                           [ngModel]="filters['manufacturer']"
                           (ngModelChange)="filters['manufacturer'] = $event"
                           placeholder="z.B. Bosch, Sensirion...">
                </mat-form-field>

                <!-- Kategorie -->
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Kategorie</mat-label>
                    <mat-select [ngModel]="filters['category']"
                                (ngModelChange)="filters['category'] = $event">
                        <mat-option [value]="''">Alle</mat-option>
                        @for (cat of categories; track cat.value) {
                            <mat-option [value]="cat.value">{{ cat.label }}</mat-option>
                        }
                    </mat-select>
                </mat-form-field>

                <!-- Protokoll -->
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Protokoll</mat-label>
                    <mat-select [ngModel]="filters['protocol']"
                                (ngModelChange)="filters['protocol'] = $event">
                        <mat-option [value]="''">Alle</mat-option>
                        @for (proto of protocols; track proto.value) {
                            <mat-option [value]="proto.value">{{ proto.label }}</mat-option>
                        }
                    </mat-select>
                </mat-form-field>
            </div>
        </ng-template>

        <!-- Icon Column Template -->
        <ng-template [myiotgridColumnTemplate]="'icon'" let-row>
            <div class="sensor-icon" [style.background-color]="row.color || '#666'">
                <mat-icon>{{ row.icon || 'sensors' }}</mat-icon>
            </div>
        </ng-template>

        <!-- Category Column Template -->
        <ng-template [myiotgridColumnTemplate]="'category'" let-row>
            <span class="category-chip">{{ getCategoryLabel(row.category) }}</span>
        </ng-template>

        <!-- Protocol Column Template -->
        <ng-template [myiotgridColumnTemplate]="'protocol'" let-row>
            <span>{{ getProtocolLabel(row.protocol) }}</span>
        </ng-template>

    </myiotgrid-generic-table>
  }
</div>
