<div class="dashboard">
  <!-- Header -->
  <header class="dashboard-header">
    <div class="header-content">
      <h1 class="page-title">Dashboard</h1>
      <myiotgrid-connection-status></myiotgrid-connection-status>
    </div>
  </header>

  @if (isLoading()) {
    <myiotgrid-loading-spinner message="Dashboard wird geladen..."></myiotgrid-loading-spinner>
  } @else {
    <!-- Alerts Banner -->
    @if (criticalAlerts().length > 0 || warningAlerts().length > 0) {
      <section class="alerts-section">
        @for (alert of criticalAlerts(); track alert.id) {
          <myiotgrid-alert-banner
            [alert]="alert"
            (acknowledge)="acknowledgeAlert($event)">
          </myiotgrid-alert-banner>
        }
        @for (alert of warningAlerts(); track alert.id) {
          <myiotgrid-alert-banner
            [alert]="alert"
            (acknowledge)="acknowledgeAlert($event)">
          </myiotgrid-alert-banner>
        }
      </section>
    }

    <!-- Stats Overview -->
    <section class="stats-section">
      <mat-card class="stat-card">
        <mat-card-content>
          <mat-icon class="stat-icon hubs">hub</mat-icon>
          <div class="stat-info">
            <span class="stat-value">{{ onlineHubs().length }}/{{ hubs().length }}</span>
            <span class="stat-label">Hubs Online</span>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <mat-icon class="stat-icon online">router</mat-icon>
          <div class="stat-info">
            <span class="stat-value">{{ onlineNodes().length }}</span>
            <span class="stat-label">Nodes Online</span>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <mat-icon class="stat-icon offline">router</mat-icon>
          <div class="stat-info">
            <span class="stat-value">{{ offlineNodes().length }}</span>
            <span class="stat-label">Nodes Offline</span>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <mat-icon class="stat-icon warning">warning</mat-icon>
          <div class="stat-info">
            <span class="stat-value">{{ activeAlerts().length }}</span>
            <span class="stat-label">Warnungen</span>
          </div>
        </mat-card-content>
      </mat-card>
    </section>

    <!-- Nodes Grid -->
    <section class="nodes-section">
      <h2 class="section-title">Nodes</h2>

      @if (nodes().length === 0) {
        <myiotgrid-empty-state
          icon="router"
          title="Keine Nodes"
          message="Es wurden noch keine Nodes registriert. Verbinden Sie einen ESP32 oder LoRa32 Node mit dem Hub."
          actionLabel="Mehr erfahren">
        </myiotgrid-empty-state>
      } @else {
        <div class="nodes-grid">
          @for (node of nodes(); track node.id) {
            <myiotgrid-node-card
              [node]="node"
              [latestReadings]="getLatestReadingsForNode(node.id)">
            </myiotgrid-node-card>
          }
        </div>
      }
    </section>
  }
</div>
